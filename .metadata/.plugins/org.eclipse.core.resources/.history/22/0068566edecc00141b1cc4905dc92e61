#include "lcd.h"

#include <stdint.h>
#include <stdbool.h>
#include "tm4c123gh6pm.h"
#include "systick.h"

void lcd_putch(char c)
{
  LCD_RS(1); 
  
  delay_ms(2);       
  
  LCD_DATA = ((c & 0xF0) >> 4);
  EN_ACKAPA();
  LCD_DATA =  (c & 0x0F);
  EN_ACKAPA();
}

void lcd_command(unsigned char c)
{
  LCD_RS(0);
  
  delay_ms(2);      
  
  LCD_DATA = ((c & 0xF0) >> 4);
  EN_ACKAPA();
  LCD_DATA =  (c & 0x0F);
  EN_ACKAPA();
}

void lcd_clear(void)
{  
  lcd_command(0x01);
  delay_ms(10);
}

void lcd_puts(const char* s)
{ 
  while(*s)
    lcd_putch(*s++);
}

void lcd_goto(char x, char y)
{ 
  if(x==1)
    lcd_command(0x80+((y-1)%16));
  else
    lcd_command(0xC0+((y-1)%16));
}
	
void lcd_init()
{
  /*SYSCTL_RCGC2_R     |=  SYSCTL_RCGC2_GPIOB;	// GPIOB Active
  GPIO_PORTB_DIR_R   |=  0x03;          
  GPIO_PORTB_AFSEL_R &= ~0x03;          
  GPIO_PORTB_DEN_R   |=  0x03;          
  GPIO_PORTB_PCTL_R   =  0xFFFFFF00;    
  GPIO_PORTB_AMSEL_R &=  0x03;          

  SYSCTL_RCGC2_R     |=  SYSCTL_RCGC2_GPIOD;	// GPIOD Active
  GPIO_PORTD_DIR_R   |=  0x0F;          
  GPIO_PORTD_AFSEL_R &= ~0x0F;          
  GPIO_PORTD_DEN_R   |=  0x0F;          
  GPIO_PORTD_PCTL_R  &=  0xFFFF0000;    
  GPIO_PORTD_AMSEL_R &= ~0x0F;          
*/
  LCD_RS(0);
  LCD_EN(0);

  lcd_command(0x28);  //  4 Bit, Dual LCD Exchange
  lcd_command(0x0C);  // Hiding the Cursor
  lcd_command(0x06);  // Right to correctly write active
  lcd_command(0x80);  // The LCD is the first Exchange Location
  lcd_command(0x28);  // 4 Bit, Dual LCD Exchange
  lcd_clear();    // Display Flushing
}
